<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hombres - Tienda Urbana</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

   <header class="banner">
    <div class="banner-texto">
    <h1>Tienda Urbana</h1>
  </div>
  </header>
  <nav>
    <a href="index.html">Inicio</a>
    <a href="hombres.html">Hombres</a>
    <a href="mujeres.html">Mujeres</a>
    <a href="contacto.html">Contacto</a>
    <a href="perfil.html">Perfil</a>
  </nav>

  <main class="container">
    <div class="form-container">
      <h1>Formulario de Compra</h1>
      <form action="#" method="POST">
          <label for="ordenCompra">Orden de Compra:</label>
          <input type="text" id="ordenCompra" name="ordenCompra" required>

          <label for="monto">Monto:</label>
          <input type="number" id="monto" name="monto" required>

          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" name="nombre" required>

          <label for="apellido">Apellido:</label>
          <input type="text" id="apellido" name="apellido" required>

          <label for="correo">Correo Electrónico:</label>
          <input type="email" id="correo" name="correo" required>

          <button type="submit">Realizar Compra</button>
      </form>
  </div>
  </main>
</body>

<script>
  const BASE_API_URL = "http://localhost:3000";
  document.getElementById("paymentForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const messageEl = document.getElementById("message");
    messageEl.textContent = "Generando sesión de pago...";

    const formData = {
      amount: parseFloat(document.getElementById("amount").value),
      cardholderName: document.getElementById("cardholderName").value,
      cardholderLastname: document.getElementById("cardholderLastname").value,
      email: document.getElementById("email").value,
    };

    try {
      const resp = await fetch(`${BASE_API_URL}/api/payment/create`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      const data = await resp.json();

      console.log('data', data);

      if (!resp.ok) throw new Error(data.error || "Error creando pago");

      const dataVisa = {
        sessiontoken: data.sessionToken,
        channel: 'web',
        merchantid: data.merchantId,
        purchasenumber: data.purchaseNumber,
        amount: data.amount,
        expirationminutes: '20',
        timeouturl: 'about:blank',
        merchantlogo: 'img/comercio.png',
        formbuttoncolor: '#000000',
        action: `${BASE_API_URL}/api/payment/callback?purchaseNumber=${data.purchaseNumber}`,
        complete: function (params) {
          alert(JSON.stringify(params));
        }
      }

      console.log('dataVisa', dataVisa);

      VisanetCheckout.configure(dataVisa);
      VisanetCheckout.open();

    } catch (err) {
      messageEl.textContent = "Error: " + err.message;
    }
  });
</script>
<footer>
    <p>Síguenos en redes sociales:</p>
    <a href="#">Facebook</a> | 
    <a href="#">Instagram</a> | 
    <a href="#">TikTok</a>
  </footer>
</html>
